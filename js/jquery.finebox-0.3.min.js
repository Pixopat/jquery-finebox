(function(c){c.extend(c.expr[":"],{inView:function(e){var f=(document.documentElement.scrollTop||document.body.scrollTop),g=Math.round(c(e).offset().top),d=(window.innerHeight&&window.innerHeight<c(window).height())?window.innerHeight:c(window).height();return !(g>(d-f)||(c(e).height()+g)<f)}});function a(d){this.$indicator=c("<span/>",{"class":"indicator",style:"display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-position: center center;"});this.$parent=d.css("position","relative")}a.prototype.add=function(){this.$indicator.hide().prependTo(this.$parent).fadeTo("fast",0.75)};a.prototype.remove=function(){this.$indicator.fadeOut("fast").remove()};var b={isLoaded:false,isLoading:false,isOpened:false,isOpening:false,enableSlideShow:false,isIE:jQuery.browser.msie,isIE6:(jQuery.browser.msie&&jQuery.browser.version<7),$current:{},$overlay:{},$wrapper:{},$container:{},hook:function(d){if(d&&typeof d==="string"){if(b.publics[d]&&typeof b.publics[d]==="function"){return b.publics[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(b[d]&&typeof b[d]==="function"){return b[d].apply(this,Array.prototype.slice.call(arguments,1))}}}},isImage:function(d){return(/\.(gif|png|jpg|jpeg|bmp)(?:\?([^#]*))?(?:#(\.*))?$/i).test(d)},fixIELacks:function(){if(!Array.indexOf){Array.prototype.indexOf=function(e,f){var d;for(d=(f||0);d<this.length;d++){if(this[d]===e){return d}}return -1}}if(b.isIE6){c("body").css("height","100%")}},setMessage:function(e,g,f){var d=b.publics.getOptions();c("<div/>",{"class":d.prefix+"-message",style:"display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; text-align: center; line-height: "+f.height()+"px;"}).html('<span class="'+d.prefix+"-"+g+'">'+e+"</span>").hide().prependTo(f).fadeIn("fast",function(){c(this).delay(d.messageDelay).fadeOut("slow",function(){c(this).remove()})})},getBiggestInFragment:function(g){var f=0,e,d;c("img",g).each(function(){e=c(this);f=Math.max(f,e.width());if(e.width()>=f){d=e}});if(d){return d}return false},scrollbarWidth:0,getScrollbarWidth:function(){if(b.scrollbarWidth===0){var f,e,d;f=c('<div style="width:50px;height:50px;overflow:hidden;position:absolute;top:-200px;left:-200px;"><div style="height:100px;"></div>');c("body").append(f);e=c("div",f).innerWidth();f.css("overflow-y","scroll");d=c("div",f).innerWidth();c(f).remove();b.scrollbarWidth=e-d}return b.scrollbarWidth},freezeWindowScroll:function(){c("body").css("width",document.documentElement.clientWidth);c("html").css({overflow:"hidden","max-height":"100%"}).scrollTop(b.$overlay.data("fineBox").scrollY).scrollLeft(b.$overlay.data("fineBox").scrollX);if(typeof b.$overlay.data("fineBox").options.hookFreezeWindowScroll==="function"){b.$overlay.data("fineBox").options.hookFreezeWindowScroll.apply(b,[b.$overlay.data("fineBox")])}},unfreezeWindowScroll:function(){c("body").css("width","100%");c("html").css({overflow:"auto","max-height":"none",width:"100%"}).add("body").scrollTop(b.$overlay.data("fineBox").scrollY).scrollLeft(b.$overlay.data("fineBox").scrollX);if(typeof b.$overlay.data("fineBox").options.hookUnfreezeWindowScroll==="function"){b.$overlay.data("fineBox").options.hookUnfreezeWindowScroll.apply(b,[b.$overlay.data("fineBox")])}},setHash:function(){document.location.hash="open="+(b.$current.attr("href"))},unsetHash:function(){document.location.hash=""},openFromHash:function(e){var g,f,d=new RegExp(e+"=");if(!e){return}if(d.test(window.location.hash)){g=window.location.hash.slice(1).replace(d,"")}else{return}if(!g){return}f=c('a[href*="'+g+'"]').eq(0);if(f.length>0){f.trigger("click.fineBox")}else{c("html, body").stop(true).animate({scrollTop:(c(document).height()-c(window).height())},function(){b.setOriginData();b.openFromHash(e)})}},init:function(f){var e={transitionMode:"full",filter:"div:first-child",prefix:"finebox",loop:true,messageDelay:3000,overlayOpacity:0.75,selector:this.selector,easingIn:"linear",easingOut:"linear",durationIn:"fast",durationOut:"fast",hookInit:null,hookAlterOverlayData:null,hookOnOpen:null,hookOnClose:null,hookFreezeWindowScroll:null,hookUnfreezeWindowScroll:null,hookAdjust:null,hookPager:null,hashArg:"open",viewportSpace:40,strings:{prev:"Previous",next:"Next",loadNext:"Loading next&hellip;",loadError:"This image could not be loaded"},slideshow:true,interval:5000},d=window.console||null;if(d){c.error=d.error}else{c.error=function(){return}}c.easing=c.easing||{};f=f||{};if(f.easingIn&&!c.easing.hasOwnProperty(f.easingIn)){c.error("To use "+f.easingIn+" easing method, jQuery.fineBox require jQuery.easing plugin. \nDownload it @url http://plugins.jquery.com/project/Easing");delete f.easingIn}if(f.easingIn&&!c.easing.hasOwnProperty(f.easingOut)){c.error("To use "+f.easingOut+" easing method, jQuery.fineBox require jQuery.easing plugin. \nDownload it @url http://plugins.jquery.com/project/Easing");delete f.easingOut}if(f){c.extend(e,f)}b.fixIELacks();b.touchPlaceholder(e);if((typeof e.hookInit)==="function"){e.hookInit.apply(b)}setTimeout(function(){b.openFromHash(e.hashArg)},(e.messageDelay/2));return this.not("."+e.prefix+"-processed").each(function(){var h=c(this),g=h.data("fineBox");if(!g){h.data("fineBox",{"$origin":h,options:e}).css({display:"block"});if(!b.$overlay.data("fineBox").$elements){b.$overlay.data("fineBox").$elements=[]}b.$overlay.data("fineBox").$elements.push(h[0]);b.bindEvents(this);c(e.filter).find('a[href="'+h.attr("href")+'"]:not(.'+e.prefix+"-processed)").not(this).unbind("click").bind("click.fineBox",function(i){i.stopImmediatePropagation();h.trigger("click.fineBox");return false}).addClass(e.prefix+"-processed")}}).addClass(e.prefix+"-processed")},touchPlaceholder:function(d){if(c("#finebox-overlay").length===0){b.$overlay=c("<div />",{id:d.prefix+"-overlay"}).css({position:(b.isIE6?"absolute":"fixed"),left:0,top:(b.isIE6?c(window).scrollTop():0),width:"100%",height:"100%"}).hide().appendTo("body").data("fineBox",{options:d})}if(c("#finebox-wrapper").length===0){b.$wrapper=c("<div />",{id:d.prefix+"-wrapper"}).css({position:(b.isIE6?"absolute":"fixed"),left:0,top:(b.isIE6?c(window).scrollTop():0),width:"100%",height:"100%","background-color":"transparent"}).hide().appendTo("body")}if(c("#finebox-container").length===0){b.$container=c("<div />",{id:d.prefix+"-container"}).css({position:"absolute",left:0,top:0}).appendTo("#"+d.prefix+"-wrapper")}b.bindPlaceholderEvents(d)},bindPlaceholderEvents:function(d){b.$overlay.add(b.$wrapper).not("."+d.prefix+"-processed").bind("click.fineBox",function(){if(!b.isLoaded){return false}b.closeItem();return false}).addClass(d.prefix+"-processed");b.$container.bind("click.fineBox",function(f){f.stopPropagation()}).css("cursor","default");c(document).bind("keydown.fineBox",function(e){if(e.keyCode===27){if(!b.isLoaded){return false}b.closeItem();return false}});c(window).resize(function(){if(b.isOpened&&b.isLoaded){b.adjust()}})},bindEvents:function(d){c(d).unbind("click").bind({"click.fineBox":function(){b.isLoaded=false;b.isLoading=true;b.load(c(this));return false},"mouseenter.fineBox":function(){c(this).addClass("hover");return false},"mouseleave.fineBox":function(){c(this).removeClass("hover");return false}})},setOriginData:function(){var p=b.$current.data("fineBox").options,d=b.getBiggestInFragment(b.$current),k=d.width(),f=d.height(),o=c("body").scrollLeft()>0?c("body").scrollLeft():c(window).scrollLeft(),n=c("body").scrollTop()>0?c("body").scrollTop():c(window).scrollTop(),j=Math.round(d.offset().left-o),i=Math.round(d.offset().top-n),m=b.$overlay.data("fineBox").$elements,l=m.indexOf(b.$current[0]),e=p.loop?c(m[l-1]||m[m.length-1]):c(m[l-1]),g=p.loop?c(m[l+1]||m[0]):c(m[l+1]),h={CSSorigin:{width:k,height:f,top:i,left:j},scrollX:o,scrollY:n,"$previous":e,"$next":g};c.extend(b.$overlay.data("fineBox"),h)},setOverlayData:function(){var f=b.$overlay.data("fineBox"),r,h=f.$image,d,l,k,q,m=c(window).width(),g=c(window).height(),p,i,o,n,j,e;d=c("<img />").attr("src",h.attr("src")).addClass(f.options.prefix+"-image");k=d[0].width;q=d[0].height;p=k;i=q;if(k>=(m-f.options.viewportSpace-1)){p=Math.round(m-f.options.viewportSpace);i=Math.round((q/k)*p)}if(i>=(g-f.options.viewportSpace-1)){i=Math.round(g-f.options.viewportSpace);p=Math.round((k/q)*i)}j=p;e=i;o=Math.round((m-p)/2);n=Math.round((g-i)/2);r={CSSoverlay:{width:p,height:i,top:n,left:o,overflow:"visible"},CSSimage:{width:j,height:e,overflow:"visible"},"$image":d};c.extend(b.$overlay.data("fineBox"),r);if(typeof f.options.hookAlterOverlayData==="function"){l=f.options.hookAlterOverlayData.apply(b,[b.$overlay.data("fineBox")]);if(l){c.extend(b.$overlay.data("fineBox"),l)}}},adjust:function(){var d;if(b.isLoading){return false}b.setOverlayData();d=b.$overlay.data("fineBox");b.unfreezeWindowScroll();b.$container.find("."+d.options.prefix+"-image").stop(true).animate({width:d.CSSimage.width,height:d.CSSimage.height,overflow:"visible"},d.options.durationIn,d.options.easingIn);b.$container.stop(true).animate(d.CSSoverlay,d.options.durationIn,d.options.easingIn,function(){b.freezeWindowScroll();b.setOriginData();if(typeof d.options.hookAdjust==="function"){d.options.hookAdjust.apply(b,[b.$overlay.data("fineBox")])}})},load:function(j){var n=j.data("fineBox").options,f=j.parent(),m,h,d,e=!b.isOpened?f:b.$container,k=new a(e);b.$current=j;b.isLoading=true;k.add();j.fadeTo("fast",0.5);function i(p){var o=arguments;b.isLoading=false;j.fadeTo("fast",1,function(){k.remove();if(p){b.hook.apply(b,o)}})}function g(){if(b.isOpened){setTimeout(function(){b.setMessage(n.strings.loadNext,"normal",e);setTimeout(function(){b.publics.next()},n.messageDelay)},(n.messageDelay*1.2))}}function l(){i("setMessage",n.strings.loadError,"error",e);g()}if(j.get(0).nodeName==="A"){if(b.isImage(j.attr("href"))){c(h=new Image()).error(l).load(function(){h.onload=null;i();m=c('<div class="'+n.prefix+'-inner" />');setTimeout(function(){c.extend(b.$overlay.data("fineBox"),{"$image":c(h)});b.openItem(j,m)},1)}).addClass(n.prefix+"-image");setTimeout(function(){h.src=j.attr("href")},1)}else{c.ajax({type:"GET",url:j.attr("href"),cache:true,dataType:"html",async:true,success:function(o){m=c(o).find(n.filter).attr("id",null).addClass(n.prefix+"-inner");c(h=new Image()).error(l).load(function(){h.onload=null;i();setTimeout(function(){c.extend(b.$overlay.data("fineBox"),{"$image":c(h)});b.openItem(j,m)},1)}).addClass(n.prefix+"-image").get(0);setTimeout(function(){d=b.getBiggestInFragment(m).detach();h.src=d.attr("src")},1)},error:l})}}},openItem:function(e,f){var d=e.data("fineBox").options;b.isOpening=true;c.extend(b.$overlay.data("fineBox"),{"$origin":e,"$fragment":f,options:d});b.$current=e;if(!b.isOpened||d.transitionMode==="minimal"){b.setOriginData()}b.setOverlayData();b.freezeWindowScroll();b.setHash();switch(d.transitionMode){case"full":b.closeItem("fireOpening");break;case"minimal":b.fireOpening();break}},closeItem:function(h){var g=b.$overlay.data("fineBox"),e=g.options,f=g.CSSorigin,d=arguments;if(!b.isLoaded){return false}b.enableSlideShow=false;b.hidePager();b.hideFragment();if(b.isOpened){b.$overlay.fadeOut("fast",function(){b.isOpened=false;b.getBiggestInFragment(b.$container).stop(true).animate({width:f.width,height:f.height,overflow:"visible"},e.durationOut,e.easingOut);b.$container.removeClass("opened").stop(true).animate(f,e.durationOut,e.easingOut,function(){c(this).fadeOut("fast",function(){b.$container.empty();b.$wrapper.hide();b.unsetHash();b.unfreezeWindowScroll();b.setOriginData();if(h){b.hook.apply(b,d)}})})})}else{if(h){b.hook.apply(b,d)}}},fireOpening:function(){var j=b.$overlay.data("fineBox"),g=j.options,i=j.$image,h=j.CSSorigin,e=j.CSSoverlay,f=j.CSSimage,d=!b.isOpened?b.$current.parent():b.$container;if(!b.isOpened){i.css({width:h.width,height:h.height,overflow:"visible"}).detach().appendTo(b.$container).show();b.$wrapper.show();b.$container.css(h).fadeIn("fast",function(){if(g.transitionMode==="full"){b.freezeWindowScroll()}i.stop(true).animate({width:f.width,height:f.height,overflow:"visible"},g.durationIn,g.easingIn);c(this).stop(true).animate(e,g.durationIn,g.easingIn,function(){c(this).addClass("opened");b.isOpening=false;b.isOpened=true;if((typeof g.hookOnOpen)==="function"){g.hookOnOpen.apply(b)}else{b.showFragment()}b.showPager();b.$overlay.fadeTo("slow",g.overlayOpacity,function(){b.isLoaded=true;if(b.enableSlideShow){setTimeout(function(){b.setMessage(g.strings.loadNext,"normal",d);setTimeout(function(){b.publics.next()},g.messageDelay)},(g.interval))}})})})}else{b.hidePager();i.css({width:f.width,height:f.height,overflow:"visible"});b.hideFragment().stop(true).delay(g.durationIn).find("."+g.prefix+"-image").fadeOut((g.durationIn/1.2),function(){c(this).remove()}).end().delay((g.durationIn/1.2)).animate(e,g.durationIn,g.easingIn,function(){i.hide().appendTo(b.$container).fadeIn("fast",function(){b.isOpening=false;b.isOpened=true;if((typeof g.hookOnOpen)==="function"){g.hookOnOpen.apply(b)}else{b.showFragment()}b.showPager();b.isLoaded=true;if(b.enableSlideShow){setTimeout(function(){b.setMessage(g.strings.loadNext,"normal",d);setTimeout(function(){b.publics.next()},g.messageDelay)},(g.interval))}})})}},showFragment:function(){var d=b.$overlay.data("fineBox");if(d.$fragment.html()!==""){d.$fragment.hide().css({position:"absolute",top:0,right:"3em",width:"33%",height:"auto"}).appendTo(b.$container).fadeIn()}else{d.$fragment.remove()}},hideFragment:function(){var d=b.$overlay.data("fineBox");if((typeof d.options.hookOnClose)==="function"){return d.options.hookOnClose.apply(b)}else{return b.$container.find("."+d.options.prefix+"-inner").fadeOut("fast",function(){c(this).remove()}).end()}},showPager:function(){var e=b.$overlay.data("fineBox"),f,d;if(typeof e.options.hookPager==="function"){e.options.hookPager.apply(b,[e.options.prefix+"-previous",e.options.prefix+"-next"])}f=b.$container.find("."+e.options.prefix+"-previous");d=b.$container.find("."+e.options.prefix+"-next");if(f.length===0){f=c("<div />",{"class":e.options.prefix+"-previous",style:"position: absolute; left: 10px; bottom: 10px; z-index: 10;"}).append("<a />").hide().prependTo(b.$container)}if(d.length===0){d=c("<div />",{"class":e.options.prefix+"-next",style:"position: absolute; right: 10px; bottom: 10px; z-index: 11;"}).append("<a />").hide().prependTo(b.$container)}if(e.$previous.length>0){f.find("a").attr("href",e.$previous.attr("href")).html("<span>"+e.options.strings.prev+"<span>").unbind("click").bind("click.fineBox",function(){b.publics.previous();return false}).end().fadeIn()}if(e.$next.length>0){d.find("a").attr("href",e.$next.attr("href")).html("<span>"+e.options.strings.next+"<span>").unbind("click").bind("click.fineBox",function(){b.publics.next();return false}).end().fadeIn()}},hidePager:function(){var e=b.$overlay.data("fineBox"),f=b.$container.find("."+e.options.prefix+"-previous"),d=b.$container.find("."+e.options.prefix+"-next");f.add(d).fadeOut().find("a").attr("href","").html("").unbind("click.fineBox")},scrollToIfNotInView:function(d){var e=b.$overlay.data("fineBox");if(d.length>0&&!d.is(":inView")){c("html, body").stop(true).animate({scrollTop:(d.offset().top-e.options.viewportSpace)},{duration:e.options.durationIn,easing:e.options.easingIn,complete:function(){b.setOriginData()}})}},publics:{getOptions:function(){return b.$current.data("fineBox").options},open:function(d){if(!this.data("fineBox")){this.fineBox(d)}b.load(this);return this},previous:function(){b.scrollToIfNotInView(b.$overlay.data("fineBox").$previous);b.$overlay.data("fineBox").$previous.trigger("click.fineBox")},next:function(){b.scrollToIfNotInView(b.$overlay.data("fineBox").$next);b.$overlay.data("fineBox").$next.trigger("click.fineBox")},destroy:function(){}}};c.fn.fineBox=function(d){if(b.publics[d]){return b.publics[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){return b.init.apply(this,arguments)}else{c.error("Method "+d+" does not exist on jQuery.fineBox")}}}})(jQuery);