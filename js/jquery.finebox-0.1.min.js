(function(c){c.extend(c.expr[":"],{inView:function(e){var f=(document.documentElement.scrollTop||document.body.scrollTop),g=Math.round(c(e).offset().top),d=(window.innerHeight&&window.innerHeight<c(window).height())?window.innerHeight:c(window).height();return !(g>(d-f)||(c(e).height()+g)<f)}});function a(d){this.$indicator=c("<span/>",{"class":"indicator",style:"display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-position: center center;"});this.$parent=d.css("position","relative")}a.prototype.add=function(){this.$indicator.hide().prependTo(this.$parent).fadeIn("fast")};a.prototype.remove=function(){this.$indicator.fadeOut("fast").remove()};var b={isLoaded:false,isLoading:false,isOpened:false,isOpening:false,isIE:jQuery.browser.msie,isIE6:(jQuery.browser.msie&&jQuery.browser.version<7),$current:{},$overlay:{},$wrapper:{},$container:{},hook:function(d){if(d&&typeof d==="string"){if(b.publics[d]&&typeof b.publics[d]==="function"){return b.publics[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(b[d]&&typeof b[d]==="function"){return b[d].apply(this,Array.prototype.slice.call(arguments,1))}}}},isImage:function(d){return(/\.(gif|png|jpg|jpeg|bmp)(?:\?([^#]*))?(?:#(\.*))?$/i).test(d)},fixIELacks:function(){if(!Array.indexOf){Array.prototype.indexOf=function(e,f){var d;for(d=(f||0);d<this.length;d++){if(this[d]===e){return d}}return -1}}if(b.isIE6){c("body").css("height","100%")}},setMessage:function(e,g,f){var d=b.publics.getOptions();c("<div/>",{"class":d.prefix+"-message",style:"display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; text-align: center; line-height: "+f.height()+"px;"}).html('<span class="'+d.prefix+"-"+g+'">'+e+"</span>").hide().prependTo(f).fadeIn("fast",function(){c(this).delay(d.messageDelay).fadeOut("slow",function(){c(this).remove()})})},getBiggestInFragment:function(g){var f=0,e,d;c("img",g).each(function(){e=c(this);f=Math.max(f,e.width());if(e.width()>=f){d=e}});if(d){return d}return false},freezeWindowScroll:function(){c("body").css("width",document.documentElement.clientWidth);c("html, body").css({overflow:"hidden"}).scrollTop(b.$overlay.data("fineBox").scrollY).scrollLeft(b.$overlay.data("fineBox").scrollX)},unfreezeWindowScroll:function(){c("body").css("width","100%");c("html, body").css("overflow","auto").scrollTop(b.$overlay.data("fineBox").scrollY).scrollLeft(b.$overlay.data("fineBox").scrollX)},setHash:function(){document.location.hash="open="+(b.$current.attr("href"))},unsetHash:function(){document.location.hash=""},openFromHash:function(e){if(e){var d=c('a:[href*="'+e+'"]').eq(0);if(d.length>0){d.trigger("click.fineBox")}else{b.scrollToIfNotInView(d)}}},init:function(f){var e={transitionMode:"full",filter:"div:first-child",prefix:"finebox",loop:true,messageDelay:3000,overlayOpacity:0.75,selector:this.selector,easingIn:"linear",easingOut:"linear",durationIn:"fast",durationOut:"fast",hookInit:null,hookAlterOverlayData:null,hookOnOpen:null,hookOnClose:null,hash:null,viewportSpace:40},d=window.console||null;if(d){c.error=d.error}else{c.error=window.alert}c.easing=c.easing||{};f=f||{};if(f.easingIn&&!c.easing.hasOwnProperty(f.easingIn)){c.error("To use "+f.easingIn+" easing method, jQuery.fineBox require jQuery.easing plugin. \nDownload it @url http://plugins.jquery.com/project/Easing");delete f.easingIn}if(f.easingIn&&!c.easing.hasOwnProperty(f.easingOut)){c.error("To use "+f.easingOut+" easing method, jQuery.fineBox require jQuery.easing plugin. \nDownload it @url http://plugins.jquery.com/project/Easing");delete f.easingOut}if(f){c.extend(e,f)}b.fixIELacks();b.touchPlaceholder(e);b.openFromHash(e.hash);if((typeof e.hookInit)==="function"){e.hookInit.apply(b)}return this.not("."+e.prefix+"-processed").each(function(){var h=c(this),g=h.data("fineBox");if(!g){h.data("fineBox",{"$origin":h,options:e}).css({display:"block"});if(!b.$overlay.data("fineBox").$elements){b.$overlay.data("fineBox").$elements=[]}b.$overlay.data("fineBox").$elements.push(h);b.bindEvents(this)}}).addClass(e.prefix+"-processed")},touchPlaceholder:function(d){if(c("#finebox-overlay").length===0){b.$overlay=c("<div />",{id:d.prefix+"-overlay"}).css({position:(b.isIE6?"absolute":"fixed"),left:0,top:(b.isIE6?(document.documentElement.scrollTop+document.body.scrollTop):0),width:"100%",height:"100%",overflow:"hidden"}).hide().appendTo("body").data("fineBox",{options:d})}if(c("#finebox-wrapper").length===0){b.$wrapper=c("<div />",{id:d.prefix+"-wrapper"}).css({position:(b.isIE6?"absolute":"fixed"),left:0,top:(b.isIE6?(document.documentElement.scrollTop+document.body.scrollTop):0),width:"100%",height:"100%","background-color":"transparent",overflow:"hidden"}).hide().appendTo("body")}if(c("#finebox-container").length===0){b.$container=c("<div />",{id:d.prefix+"-container"}).css({position:"absolute",left:0,top:0,overflow:"hidden"}).appendTo("#"+d.prefix+"-wrapper")}b.bindPlaceholderEvents(d)},bindPlaceholderEvents:function(d){b.$overlay.add(b.$wrapper).not("."+d.prefix+"-processed").bind("click.fineBox",function(){b.closeItem();return false}).addClass(d.prefix+"-processed");b.$container.bind("click.fineBox",function(){return false}).css("cursor","default");c(document).bind("keydown.fineBox",function(e){if(e.keyCode===27){b.closeItem();return false}});c(window).resize(function(){if(b.isOpened){b.adjust()}})},bindEvents:function(d){c(d).bind({"click.fineBox":function(){b.load(c(this));return false},"mouseenter.fineBox":function(){c(this).addClass("hover");return false},"mouseleave.fineBox":function(){c(this).removeClass("hover");return false}})},setOriginData:function(){var p=b.$current.data("fineBox").options,d=b.getBiggestInFragment(b.$current),k=d.width(),f=d.height(),o=c(window).scrollLeft(),n=c(window).scrollTop(),j=Math.round(d.offset().left-o),i=Math.round(d.offset().top-n),m=c.makeArray(c(p.filter).find(p.selector+"."+p.prefix+"-processed")),l=m.indexOf(b.$current[0]),e=p.loop?c(m[l-1]||m[m.length-1]):c(m[l-1]),g=p.loop?c(m[l+1]||m[0]):c(m[l+1]),h={CSSorigin:{width:k,height:f,top:i,left:j},scrollX:o,scrollY:n,"$previous":e,"$next":g};c.extend(b.$overlay.data("fineBox"),h)},setOverlayData:function(){var e=b.$overlay.data("fineBox"),q,o=e.$fragment,g=e.$image,d,j,i,p,k=c(window).width(),f=c(window).height(),n,h,m,l;d=c("<img />").attr("src",g.attr("src")).addClass(e.options.prefix+"-image");i=d[0].width;p=d[0].height;n=i;h=p;if(i>=(k-e.options.viewportSpace-1)){n=Math.round(k-e.options.viewportSpace);h=Math.round((p/i)*n)}if(h>=(f-e.options.viewportSpace-1)){h=Math.round(f-e.options.viewportSpace);n=Math.round((i/p)*h)}m=Math.round((k-n)/2);l=Math.round((f-h)/2);q={CSSoverlay:{width:n,height:h,top:l,left:m},"$image":d};if(typeof e.options.hookAlterOverlayData==="function"){j=e.options.hookAlterOverlayData.apply(b,o,d);if(j){c.extend(q,j)}}c.extend(b.$overlay.data("fineBox"),q)},adjust:function(){var d;b.setOverlayData();d=b.$overlay.data("fineBox");b.unfreezeWindowScroll();b.$container.find("."+d.options.prefix+"-image").stop().animate({width:d.CSSoverlay.width,height:d.CSSoverlay.height},d.options.durationIn,d.options.easingIn);b.$container.stop().animate(d.CSSoverlay,d.options.durationIn,d.options.easingIn,function(){b.freezeWindowScroll();b.setOriginData()})},load:function(j){var n=j.data("fineBox").options,f=j.parent(),m,h,d,e=!b.isOpened?f:b.$container,k=new a(e);b.$current=j;b.isLoading=true;k.add();j.fadeTo("fast",0.5);function i(p){var o=arguments;b.isLoading=false;b.isLoaded=true;k.remove();j.fadeTo("fast",1,function(){if(p){b.hook.apply(b,o)}})}function g(){if(b.isOpened){setTimeout(function(){b.setMessage("Loading next&hellip;","normal",e);setTimeout(function(){b.publics.next()},n.messageDelay)},(n.messageDelay*1.2))}}function l(){i("setMessage","This image could not be loaded","error",e);g()}if(j.get(0).nodeName==="A"){if(b.isImage(j.attr("href"))){c(h=new Image()).error(l).load(function(){h.onload=null;i();m=c('<div class="'+n.prefix+'-inner" />');setTimeout(function(){c.extend(b.$overlay.data("fineBox"),{"$image":c(h)});b.openItem(j,m)},1)}).addClass(n.prefix+"-image");setTimeout(function(){h.src=j.attr("href")},1)}else{c.ajax({type:"GET",url:j.attr("href"),cache:true,dataType:"html",async:true,success:function(o){m=c(o).find(n.filter).attr("id",null).addClass(n.prefix+"-inner");c(h=new Image()).error(l).load(function(){h.onload=null;i();setTimeout(function(){c.extend(b.$overlay.data("fineBox"),{"$image":c(h)});b.openItem(j,m)},1)}).addClass(n.prefix+"-image").get(0);setTimeout(function(){d=b.getBiggestInFragment(m).detach();h.src=d.attr("src")},1)},error:l})}}},openItem:function(e,f){var d=e.data("fineBox").options;b.isOpening=true;c.extend(b.$overlay.data("fineBox"),{"$origin":e,"$fragment":f,options:d});b.$current=e;if(!b.isOpened||d.transitionMode==="minimal"){b.setOriginData()}b.setOverlayData();b.freezeWindowScroll();b.setHash();switch(d.transitionMode){case"full":b.closeItem("fireOpening");break;case"minimal":b.fireOpening();break}},closeItem:function(h){var g=b.$overlay.data("fineBox"),e=g.options,f=g.CSSorigin,d=arguments;b.hidePager();b.hideFragment();if((typeof e.hookOnClose)==="function"){e.hookOnClose.apply(b,g)}if(b.isOpened){b.$overlay.fadeOut("fast",function(){b.isOpened=false;b.getBiggestInFragment(b.$container).animate({width:f.width,height:f.height},e.durationOut,e.easingOut);b.$container.removeClass("opened").animate(f,e.durationOut,e.easingOut,function(){c(this).fadeOut("fast",function(){b.$container.empty();b.$wrapper.hide();b.unsetHash();b.unfreezeWindowScroll();b.setOriginData();if(h){b.hook.apply(b,d)}})})})}else{if(h){b.hook.apply(b,d)}}},fireOpening:function(){var h=b.$overlay.data("fineBox"),e=h.options,i=h.$fragment,g=h.$image,f=h.CSSorigin,d=h.CSSoverlay;if(!b.isOpened){g.css({width:f.width,height:f.height}).detach().appendTo(b.$container).show();b.$wrapper.show();b.$container.css(f).fadeIn("fast",function(){if(e.transitionMode==="full"){b.freezeWindowScroll()}g.animate({width:d.width,height:d.height},e.durationIn,e.easingIn);c(this).animate(d,e.durationIn,e.easingIn,function(){c(this).addClass("opened");b.showPager();b.isOpening=false;b.isOpened=true;if((typeof e.hookOnOpen)==="function"){e.hookOnOpen.apply(b,i,g)}else{b.showFragment()}b.$overlay.fadeTo("slow",e.overlayOpacity)})})}else{if((typeof e.hookOnClose)==="function"){e.hookOnClose.apply(b,h)}b.hidePager();b.hideFragment();g.css({width:d.width,height:d.height});b.$container.stop().find("."+e.prefix+"-image").fadeOut((e.durationIn/1.2),function(){c(this).remove()}).end().delay((e.durationIn/1.2)).animate(d,e.durationIn,e.easingIn,function(){g.hide().appendTo(b.$container).fadeIn("fast",function(){b.showPager();b.isOpening=false;b.isOpened=true;if((typeof e.hookOnOpen)==="function"){e.hookOnOpen.apply(b,i,g)}else{b.showFragment()}})})}},showFragment:function(){var d=b.$overlay.data("fineBox");if(d.$fragment.html()!==""){d.$fragment.hide().css({position:"absolute",top:0,right:"3em",width:"33%",height:"auto"}).appendTo(b.$container).fadeIn()}else{d.$fragment.remove()}},hideFragment:function(){var d=b.$overlay.data("fineBox");b.$container.find("."+d.options.prefix+"-inner").fadeOut("fast",function(){c(this).remove()})},showPager:function(){var e=b.$overlay.data("fineBox"),f=b.$container.find("."+e.options.prefix+"-previous"),d=b.$container.find("."+e.options.prefix+"-next");if(f.length===0){f=c("<div />",{"class":e.options.prefix+"-previous",style:"position: absolute; left: 10px; bottom: 10px;"}).append("<a />").hide().prependTo(b.$container)}if(d.length===0){d=c("<div />",{"class":e.options.prefix+"-next",style:"position: absolute; right: 10px; bottom: 10px;"}).append("<a />").hide().prependTo(b.$container)}if(e.$previous.length>0){f.find("a").attr("href",e.$previous.attr("href")).html("<span>"+e.$previous.attr("href")+"<span>").bind("click.fineBox",function(){b.publics.previous();return false}).end().fadeIn()}if(e.$next.length>0){d.find("a").attr("href",e.$next.attr("href")).html("<span>"+e.$next.attr("href")+"<span>").bind("click.fineBox",function(){b.publics.next();return false}).end().fadeIn()}},hidePager:function(){var e=b.$overlay.data("fineBox"),f=b.$container.find("."+e.options.prefix+"-previous"),d=b.$container.find("."+e.options.prefix+"-next");f.add(d).fadeOut().find("a").attr("href","").html("").unbind("click.fineBox")},openFromOverlay:function(){},scrollToIfNotInView:function(d){var e=b.$overlay.data("fineBox");if(d.length>0&&!d.is(":inView")){c("html, body").stop().animate({scrollTop:d.offset().top},{duration:e.options.durationIn,easing:e.options.easingIn,complete:function(){b.setOriginData()}})}},publics:{getOptions:function(){return b.$current.data("fineBox").options},open:function(d){if(!this.data("fineBox")){this.fineBox(d)}b.load(this);return this},previous:function(){b.scrollToIfNotInView(b.$overlay.data("fineBox").$previous,"click.fineBox");b.$overlay.data("fineBox").$previous.trigger("click.fineBox")},next:function(){b.scrollToIfNotInView(b.$overlay.data("fineBox").$next);b.$overlay.data("fineBox").$next.trigger("click.fineBox")},destroy:function(){}}};c.fn.fineBox=function(d){if(b.publics[d]){return b.publics[d].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof d==="object"||!d){return b.init.apply(this,arguments)}else{c.error("Method "+d+" does not exist on jQuery.fineBox")}}}})(jQuery);