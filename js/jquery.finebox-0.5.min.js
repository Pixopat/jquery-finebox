(function($){$.extend($.expr[":"],{inView:function(a){var st=(document.documentElement.scrollTop||document.body.scrollTop),ot=Math.round($(a).offset().top),wh=(window.innerHeight&&window.innerHeight<$(window).height())?window.innerHeight:$(window).height();return !(ot>(wh-st)||($(a).height()+ot)<st)}});function Indicator($parent){this.$indicator=$("<span/>",{"class":"indicator",style:"display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-position: center center;"});this.$parent=$parent.css("position","relative")}Indicator.prototype.add=function(cssObj){this.$indicator.hide().css(cssObj).prependTo(this.$parent).fadeTo("fast",0.75)};Indicator.prototype.remove=function(){this.$indicator.fadeOut("fast").remove()};var fineBox={isLoaded:false,isLoading:false,isOpened:false,isOpening:false,enableSlideShow:false,isIE:jQuery.browser.msie,isIE6:(jQuery.browser.msie&&jQuery.browser.version<7),$current:{},$overlay:{},$wrapper:{},$container:{},hook:function(fn){if(fn&&typeof fn==="string"){if(fineBox.publics[fn]&&typeof fineBox.publics[fn]==="function"){return fineBox.publics[fn].apply(this,Array.prototype.slice.call(arguments,1))}else{if(fineBox[fn]&&typeof fineBox[fn]==="function"){return fineBox[fn].apply(this,Array.prototype.slice.call(arguments,1))}}}},isImage:function(url){return(/\.(gif|png|jpg|jpeg|bmp)(?:\?([^#]*))?(?:#(\.*))?$/i).test(url)},fixIELacks:function(){if(!Array.indexOf){Array.prototype.indexOf=function(obj,start){var i;for(i=(start||0);i<this.length;i++){if(this[i]===obj){return i}}return -1}}if(fineBox.isIE6){$("body").css("height","100%")}},setMessage:function(message,level,$parent){var options=fineBox.publics.getOptions();$("<div/>",{"class":options.prefix+"-message",style:"display: block; position: absolute; top: 0; left: 0; width: 100%; height: 100%; text-align: center; line-height: "+$parent.height()+"px;"}).html('<span class="'+options.prefix+"-"+level+'">'+message+"</span>").hide().prependTo($parent).fadeIn("fast",function(){$(this).delay(options.messageDelay).fadeOut("slow",function(){$(this).remove()})})},getBiggestInFragment:function($fragment){var maxW=0,$this,$img;$("img",$fragment).each(function(){$this=$(this);maxW=Math.max(maxW,$this.width());if($this.width()>=maxW){$img=$this}});if($img){return $img}return false},freezeWindowScroll:function(){$("body").css("width",document.documentElement.clientWidth);$("html").css({overflow:"hidden","max-height":"100%"}).scrollTop(fineBox.$overlay.data("fineBox").scrollY).scrollLeft(fineBox.$overlay.data("fineBox").scrollX);if(typeof fineBox.$overlay.data("fineBox").options.hookFreezeWindowScroll==="function"){fineBox.$overlay.data("fineBox").options.hookFreezeWindowScroll.apply(fineBox,[fineBox.$overlay.data("fineBox")])}},unfreezeWindowScroll:function(){$("body").css("width","100%");$("html").css({overflow:"auto","max-height":"none",width:"100%"}).add("body").scrollTop(fineBox.$overlay.data("fineBox").scrollY).scrollLeft(fineBox.$overlay.data("fineBox").scrollX);if(typeof fineBox.$overlay.data("fineBox").options.hookUnfreezeWindowScroll==="function"){fineBox.$overlay.data("fineBox").options.hookUnfreezeWindowScroll.apply(fineBox,[fineBox.$overlay.data("fineBox")])}},setHash:function(){document.location.hash=fineBox.$overlay.data("fineBox").options.hashArg+"="+(fineBox.$current.attr("href"))},unsetHash:function(){document.location.hash=""},openFromHash:function(hashArg){var options=fineBox.$overlay.data("fineBox").options,uriToOpen,elementToOpen,hashArgPatt=new RegExp("(#?.*?&?"+hashArg+"=).*"),hash=window.location.hash,res=hashArgPatt.exec(hash);if(!hashArg||res===null){return}if(res[1]){uriToOpen=hash.slice(res[1].length)}else{return}if(!uriToOpen){return}if((typeof options.hookAlterUriToOpen)==="function"){uriToOpen=options.hookAlterUriToOpen.apply(fineBox,[uriToOpen])}elementToOpen=$('a[href*="'+uriToOpen+'"]').eq(0);if(elementToOpen.length>0){elementToOpen.trigger("click.fineBox")}else{if((typeof options.hookOnOpenFromHash)==="function"){options.hookOnOpenFromHash.apply(fineBox)}}},init:function(userOptions){var options={transitionMode:"full",filter:"div:first-child",prefix:"finebox",loop:true,messageDelay:3000,overlayOpacity:0.75,selector:this.selector,easingIn:"linear",easingOut:"linear",durationIn:"fast",durationOut:"fast",hookInit:null,hookAlterOverlayData:null,hookOnOpen:null,hookOnClose:null,hookFreezeWindowScroll:null,hookUnfreezeWindowScroll:null,hookAdjust:null,hookPager:null,hashArg:"open",hookOnOpenFromHash:null,hookAlterUriToOpen:null,viewportSpace:40,strings:{prev:"Previous",next:"Next",loadNext:"Loading next&hellip;",loadError:"This image could not be loaded"},slideshow:true,interval:5000},console=window.console||null;if(console){$.error=console.error}else{$.error=function(){return}}$.easing=$.easing||{};userOptions=userOptions||{};if(userOptions.easingIn&&!$.easing.hasOwnProperty(userOptions.easingIn)){$.error("To use "+userOptions.easingIn+" easing method, jQuery.fineBox require jQuery.easing plugin. \nDownload it @url http://plugins.jquery.com/project/Easing");delete userOptions.easingIn}if(userOptions.easingIn&&!$.easing.hasOwnProperty(userOptions.easingOut)){$.error("To use "+userOptions.easingOut+" easing method, jQuery.fineBox require jQuery.easing plugin. \nDownload it @url http://plugins.jquery.com/project/Easing");delete userOptions.easingOut}if(userOptions){$.extend(options,userOptions)}fineBox.fixIELacks();fineBox.touchPlaceholder(options);if((typeof options.hookInit)==="function"){options.hookInit.apply(fineBox)}setTimeout(function(){fineBox.openFromHash(options.hashArg)},(options.messageDelay/2));return this.not("."+options.prefix+"-processed").each(function(){var $this=$(this),data=$this.data("fineBox");if(!data){$this.data("fineBox",{"$origin":$this,options:options}).css({display:"block"});if(!fineBox.$overlay.data("fineBox").$elements){fineBox.$overlay.data("fineBox").$elements=[]}fineBox.$overlay.data("fineBox").$elements.push($this[0]);fineBox.bindEvents(this);$(options.filter).find('a[href="'+$this.attr("href")+'"]:not(.'+options.prefix+"-processed)").not(this).unbind("click").bind("click.fineBox",function(e){e.stopImmediatePropagation();$this.trigger("click.fineBox");return false}).addClass(options.prefix+"-processed")}}).addClass(options.prefix+"-processed")},touchPlaceholder:function(options){if($("#finebox-overlay").length===0){fineBox.$overlay=$("<div />",{id:options.prefix+"-overlay"}).css({position:(fineBox.isIE6?"absolute":"fixed"),left:0,top:(fineBox.isIE6?$(window).scrollTop():0),width:"100%",height:"100%"}).hide().appendTo("body").data("fineBox",{options:options})}if($("#finebox-wrapper").length===0){fineBox.$wrapper=$("<div />",{id:options.prefix+"-wrapper"}).css({position:(fineBox.isIE6?"absolute":"fixed"),left:0,top:(fineBox.isIE6?$(window).scrollTop():0),width:"100%",height:"100%","background-color":"transparent"}).hide().appendTo("body")}if($("#finebox-container").length===0){fineBox.$container=$("<div />",{id:options.prefix+"-container"}).css({position:"absolute",left:0,top:0}).appendTo("#"+options.prefix+"-wrapper")}fineBox.bindPlaceholderEvents(options)},bindPlaceholderEvents:function(options){fineBox.$overlay.add(fineBox.$wrapper).not("."+options.prefix+"-processed").bind("click.fineBox",function(){if(!fineBox.isLoaded){return false}fineBox.closeItem();return false}).addClass(options.prefix+"-processed");fineBox.$container.bind("click.fineBox",function(e){e.stopPropagation()}).css("cursor","default");$(document).bind("keydown.fineBox",function(event){if(event.keyCode===27){if(!fineBox.isLoaded){return false}fineBox.closeItem();return false}});$(window).resize(function(){if(fineBox.isOpened&&fineBox.isLoaded){fineBox.adjust()}})},bindEvents:function(elements){$(elements).unbind("click").bind({"click.fineBox":function(){fineBox.isLoaded=false;fineBox.isLoading=true;fineBox.load($(this));return false},"mouseenter.fineBox":function(){$(this).addClass("hover");return false},"mouseleave.fineBox":function(){$(this).removeClass("hover");return false}})},setOriginData:function(){var options=fineBox.$current.data("fineBox").options,$tmp=fineBox.getBiggestInFragment(fineBox.$current),startW=$tmp.width(),startH=$tmp.height(),scrollX=$("body").scrollLeft()>0?$("body").scrollLeft():$(window).scrollLeft(),scrollY=$("body").scrollTop()>0?$("body").scrollTop():$(window).scrollTop(),startX=Math.round($tmp.offset().left-scrollX),startY=Math.round($tmp.offset().top-scrollY),all=fineBox.$overlay.data("fineBox").$elements,index=all.indexOf(fineBox.$current[0]),$previous=options.loop?$(all[index-1]||all[all.length-1]):$(all[index-1]),$next=options.loop?$(all[index+1]||all[0]):$(all[index+1]),data={CSSorigin:{width:startW,height:startH,top:startY,left:startX},scrollX:scrollX,scrollY:scrollY,"$previous":$previous,"$next":$next};$.extend(fineBox.$overlay.data("fineBox"),data)},setOverlayData:function(){var data=fineBox.$overlay.data("fineBox"),newData,$imageBase=data.$image,$image,hookAlterOverlayDataResult,endWbase,endHbase,docW=$(window).width(),docH=$(window).height(),endW,endH,endX,endY,imgW,imgH;$image=$("<img />").attr("src",$imageBase.attr("src")).addClass(data.options.prefix+"-image");endWbase=$image[0].width;endHbase=$image[0].height;endW=endWbase;endH=endHbase;if(endWbase>=(docW-data.options.viewportSpace-1)){endW=Math.round(docW-data.options.viewportSpace);endH=Math.round((endHbase/endWbase)*endW)}if(endH>=(docH-data.options.viewportSpace-1)){endH=Math.round(docH-data.options.viewportSpace);endW=Math.round((endWbase/endHbase)*endH)}imgW=endW;imgH=endH;endX=Math.round((docW-endW)/2);endY=Math.round((docH-endH)/2);newData={CSSoverlay:{width:endW,height:endH,top:endY,left:endX},CSSimage:{width:imgW,height:imgH},"$image":$image};$.extend(fineBox.$overlay.data("fineBox"),newData);if(typeof data.options.hookAlterOverlayData==="function"){hookAlterOverlayDataResult=data.options.hookAlterOverlayData.apply(fineBox,[fineBox.$overlay.data("fineBox")]);if(hookAlterOverlayDataResult){$.extend(fineBox.$overlay.data("fineBox"),hookAlterOverlayDataResult)}}},adjust:function(){var data;if(fineBox.isLoading){return false}fineBox.setOverlayData();data=fineBox.$overlay.data("fineBox");fineBox.unfreezeWindowScroll();fineBox.$container.find("."+data.options.prefix+"-image").stop(true).animate({width:data.CSSimage.width,height:data.CSSimage.height},data.options.durationIn,data.options.easingIn);fineBox.$container.stop(true).animate(data.CSSoverlay,data.options.durationIn,data.options.easingIn,function(){fineBox.freezeWindowScroll();fineBox.setOriginData();if(typeof data.options.hookAdjust==="function"){data.options.hookAdjust.apply(fineBox,[fineBox.$overlay.data("fineBox")])}})},load:function($this){var options=$this.data("fineBox").options,$parent=$this.parent(),$fragment,img,$img,$msgTarget=!fineBox.isOpened?$parent:fineBox.$container,indicator=new Indicator($msgTarget);fineBox.$current=$this;fineBox.isLoading=true;indicator.add({display:"block",position:"absolute",top:0,left:0,width:!fineBox.isOpened?$this.width():fineBox.$overlay.data("fineBox").CSSimage.width,height:!fineBox.isOpened?$this.height():fineBox.$overlay.data("fineBox").CSSimage.height,"background-position":"center center"});$this.fadeTo("fast",0.5);function removeIndicator(callback){var args=arguments;fineBox.isLoading=false;$this.fadeTo("fast",1,function(){indicator.remove();if(callback){fineBox.hook.apply(fineBox,args)}})}function loadNextIfIsOpened(){if(fineBox.isOpened){setTimeout(function(){fineBox.setMessage(options.strings.loadNext,"normal",$msgTarget);setTimeout(function(){fineBox.publics.next()},options.messageDelay)},(options.messageDelay*1.2))}}function onErrorAction(){removeIndicator("setMessage",options.strings.loadError,"error",$msgTarget);loadNextIfIsOpened()}if($this.get(0).nodeName==="A"){if(fineBox.isImage($this.attr("href"))){$(img=new Image()).error(onErrorAction).load(function(){img.onload=null;removeIndicator();$fragment=$('<div class="'+options.prefix+'-inner" />');setTimeout(function(){$.extend(fineBox.$overlay.data("fineBox"),{"$image":$(img)});fineBox.openItem($this,$fragment)},1)}).addClass(options.prefix+"-image");setTimeout(function(){img.src=$this.attr("href")},1)}else{$.ajax({type:"GET",url:$this.attr("href"),cache:true,dataType:"html",async:true,success:function(data){$fragment=$(data).find(options.filter).attr("id",null).addClass(options.prefix+"-inner");$(img=new Image()).error(onErrorAction).load(function(){img.onload=null;removeIndicator();setTimeout(function(){$.extend(fineBox.$overlay.data("fineBox"),{"$image":$(img)});fineBox.openItem($this,$fragment)},1)}).addClass(options.prefix+"-image").get(0);setTimeout(function(){$img=fineBox.getBiggestInFragment($fragment).detach();img.src=$img.attr("src")},1)},error:onErrorAction})}}},openItem:function($this,$fragment){var options=$this.data("fineBox").options;fineBox.isOpening=true;$.extend(fineBox.$overlay.data("fineBox"),{"$origin":$this,"$fragment":$fragment,options:options});fineBox.$current=$this;if(!fineBox.isOpened||options.transitionMode==="minimal"){fineBox.setOriginData()}fineBox.setOverlayData();fineBox.freezeWindowScroll();fineBox.setHash();switch(options.transitionMode){case"full":fineBox.closeItem("fireOpening");break;case"minimal":fineBox.fireOpening();break}},closeItem:function(callback){var data=fineBox.$overlay.data("fineBox"),options=data.options,CSSorigin=data.CSSorigin,args=arguments;if(!fineBox.isLoaded){return false}fineBox.enableSlideShow=false;fineBox.hidePager();fineBox.hideFragment();if(fineBox.isOpened){fineBox.$overlay.fadeOut("fast",function(){fineBox.isOpened=false;fineBox.getBiggestInFragment(fineBox.$container).stop(true).animate({width:CSSorigin.width,height:CSSorigin.height},options.durationOut,options.easingOut);fineBox.$container.removeClass("opened").stop(true).animate(CSSorigin,options.durationOut,options.easingOut,function(){$(this).fadeOut("fast",function(){fineBox.$container.empty();fineBox.$wrapper.hide();fineBox.unsetHash();fineBox.unfreezeWindowScroll();fineBox.setOriginData();if(callback){fineBox.hook.apply(fineBox,args)}})})})}else{if(callback){fineBox.hook.apply(fineBox,args)}}},fireOpening:function(){var data=fineBox.$overlay.data("fineBox"),options=data.options,$image=data.$image,CSSorigin=data.CSSorigin,CSSoverlay=data.CSSoverlay,CSSimage=data.CSSimage,$msgTarget=!fineBox.isOpened?fineBox.$current.parent():fineBox.$container;if(!fineBox.isOpened){$image.css({width:CSSorigin.width,height:CSSorigin.height}).detach().appendTo(fineBox.$container).show();fineBox.$wrapper.show();fineBox.$container.css(CSSorigin).fadeIn("fast",function(){if(options.transitionMode==="full"){fineBox.freezeWindowScroll()}$image.stop(true).animate({width:CSSimage.width,height:CSSimage.height},options.durationIn,options.easingIn);$(this).stop(true).animate(CSSoverlay,options.durationIn,options.easingIn,function(){$(this).addClass("opened");fineBox.isOpening=false;fineBox.isOpened=true;if((typeof options.hookOnOpen)==="function"){options.hookOnOpen.apply(fineBox)}else{fineBox.showFragment()}fineBox.showPager();fineBox.$overlay.fadeTo("slow",options.overlayOpacity,function(){fineBox.isLoaded=true;if(fineBox.enableSlideShow){setTimeout(function(){fineBox.setMessage(options.strings.loadNext,"normal",$msgTarget);setTimeout(function(){fineBox.publics.next()},options.messageDelay)},(options.interval))}})})})}else{fineBox.hidePager();$image.css({width:CSSimage.width,height:CSSimage.height});fineBox.hideFragment().stop(true).delay(options.durationIn).find("."+options.prefix+"-image").fadeOut((options.durationIn/1.2),function(){$(this).remove()}).end().delay((options.durationIn/1.2)).animate(CSSoverlay,options.durationIn,options.easingIn,function(){$image.hide().appendTo(fineBox.$container).fadeIn("fast",function(){fineBox.isOpening=false;fineBox.isOpened=true;if((typeof options.hookOnOpen)==="function"){options.hookOnOpen.apply(fineBox)}else{fineBox.showFragment()}fineBox.showPager();fineBox.isLoaded=true;if(fineBox.enableSlideShow){setTimeout(function(){fineBox.setMessage(options.strings.loadNext,"normal",$msgTarget);setTimeout(function(){fineBox.publics.next()},options.messageDelay)},(options.interval))}})})}},showFragment:function(){var data=fineBox.$overlay.data("fineBox");if(data.$fragment.html()!==""){data.$fragment.hide().css({position:"absolute",top:0,right:"3em",width:"33%",height:"auto"}).appendTo(fineBox.$container).fadeIn()}else{data.$fragment.remove()}},hideFragment:function(){var data=fineBox.$overlay.data("fineBox");if((typeof data.options.hookOnClose)==="function"){return data.options.hookOnClose.apply(fineBox)}else{return fineBox.$container.find("."+data.options.prefix+"-inner").fadeOut("fast",function(){$(this).remove()}).end()}},showPager:function(){var data=fineBox.$overlay.data("fineBox"),$prevDiv,$nextDiv;if(typeof data.options.hookPager==="function"){data.options.hookPager.apply(fineBox,[data.options.prefix+"-previous",data.options.prefix+"-next"])}$prevDiv=fineBox.$container.find("."+data.options.prefix+"-previous");$nextDiv=fineBox.$container.find("."+data.options.prefix+"-next");if($prevDiv.length===0){$prevDiv=$("<div />",{"class":data.options.prefix+"-previous",style:"position: absolute; left: 10px; bottom: 10px; z-index: 10;"}).append("<a />").hide().prependTo(fineBox.$container)}if($nextDiv.length===0){$nextDiv=$("<div />",{"class":data.options.prefix+"-next",style:"position: absolute; right: 10px; bottom: 10px; z-index: 11;"}).append("<a />").hide().prependTo(fineBox.$container)}if(data.$previous.length>0){$prevDiv.find("a").attr("href",data.$previous.attr("href")).html("<span>"+data.options.strings.prev+"</span>").unbind("click").bind("click.fineBox",function(){fineBox.publics.previous();return false}).end().fadeIn()}if(data.$next.length>0){$nextDiv.find("a").attr("href",data.$next.attr("href")).html("<span>"+data.options.strings.next+"</span>").unbind("click").bind("click.fineBox",function(){fineBox.publics.next();return false}).end().fadeIn()}},hidePager:function(){var data=fineBox.$overlay.data("fineBox"),$prevDiv=fineBox.$container.find("."+data.options.prefix+"-previous"),$nextDiv=fineBox.$container.find("."+data.options.prefix+"-next");$prevDiv.add($nextDiv).fadeOut().find("a").attr("href","").html("").unbind("click.fineBox")},scrollToIfNotInView:function($element){var data=fineBox.$overlay.data("fineBox");if($element.length>0&&!$element.is(":inView")){$("html, body").stop(true).animate({scrollTop:($element.offset().top-data.options.viewportSpace)},{duration:data.options.durationIn,easing:data.options.easingIn,complete:function(){fineBox.setOriginData()}})}},publics:{getOptions:function(){return $.hasData(fineBox.$current)?fineBox.$current.data("fineBox").options:fineBox.$overlay.data("fineBox").options},open:function(options){if(!this.data("fineBox")){this.fineBox(options)}fineBox.load(this);return this},previous:function(){fineBox.scrollToIfNotInView(fineBox.$overlay.data("fineBox").$previous);fineBox.$overlay.data("fineBox").$previous.trigger("click.fineBox")},next:function(){fineBox.scrollToIfNotInView(fineBox.$overlay.data("fineBox").$next);fineBox.$overlay.data("fineBox").$next.trigger("click.fineBox")},destroy:function(){}}};$.fn.fineBox=function(method){if(fineBox.publics[method]){return fineBox.publics[method].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof method==="object"||!method){return fineBox.init.apply(this,arguments)}else{$.error("Method "+method+" does not exist on jQuery.fineBox")}}}})(jQuery);